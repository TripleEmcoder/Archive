\documentclass[12pt,a4paper,titlepage,twoside]{article}
\usepackage[T1]{fontenc}
\usepackage[cp1250]{inputenc}
\usepackage[english,polish]{babel}
\usepackage[T1]{polski}
\usepackage{times}
\usepackage{fancyhdr}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{slashbox}
\usepackage{sistyle}
\usepackage{amsfonts}
\usepackage{latexsym}
%\usepackage{notebook2e, latexsym}

\hypersetup
{
	bookmarksnumbered=true,
	colorlinks=true,
	linkcolor=blue,
	bookmarksopen=true,
	bookmarksopenlevel=2,
	pdfstartview={FitH}
}

\SIdecimalsign{,}

\setlength{\textheight}{24cm}
\setlength{\textwidth}{16cm}
\setlength{\footskip}{10mm}
\setlength{\oddsidemargin}{0mm}
\setlength{\evensidemargin}{0mm}
\setlength{\topmargin}{0mm}
\setlength{\headsep}{5mm}
\setlength{\headheight}{15.0pt}

\pagestyle{fancy}
\fancyhead{}
\fancyhead[LE,RO]{\textsf{\thepage}}
\fancyhead[RE,LO]{\textsf{Szeregowanie zadañ jednorodnych}}
\fancyhead[CE,CO]{\ }
\fancyfoot[LE,RO]{\ }
\fancyfoot[RE,LO]{\ }
\fancyfoot[CE,CO]{\ }
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}

\begin{titlepage}
\title{Przetwarzanie równoleg³e \\ Szeregowanie zadañ jednorodnych}
\author{Bartosz Kukawka (75911) \\ Marcin Miko³ajczak (75922) \\ Grupa I3A}
\end{titlepage}

\begin{document}

\maketitle

\newpage

\section{Sformu³owanie problemu}
Przedmiotem niniejszego sprawozdania jest analiza problemu przetwarzania równoleg³ego w oœmioprocesorowym systemie przetwarzania o topologii szeœcianu, który cechuje mo¿liwoœæ jednoczesnego wykonywania obliczeñ i~przesy³ania danych przez ka¿dy z~jego procesorów. Dodatkowo zak³ada siê, ¿e w~chwili zerowej obliczeñ wszystkie dane potrzebne do ich wykonania znajduj¹ siê w~jednym z~naro¿ników wspomnianego szeœcianu.

Analizowany system wraz z~przyjêtymi oznaczeniami procesorów przedstawiaj¹ pogl¹dowo rysunki \ref{fig:cube} i~\ref{fig:flat}. Procesor, który pocz¹tkowo dysponuje wszystkimi danymi, zosta³ oznaczony numerem 0. Dalsza numeracja wynika z~odleg³oœci od Ÿród³a danych. Poœród procesorów o równej odleg³oœci numeracja zosta³a przydzielona na podstawie rzutu z~rysunku \ref{fig:cube} w~kolejnoœci zgodnej z~ruchem wskazówek zegara, poczynaj¹c od procesorów na górnej, tylnej krawêdzi szeœcianu. Inny widok omawianego systemu przedstawia rysunek \ref{fig:flat}.

\begin{figure}[h!]
\centering
\includegraphics[trim=0 15mm 0 15mm, clip]{cube}
\caption{Schemat analizowanego systemu przetwarzania}
\label{fig:cube}
\end{figure}

\begin{figure}[p]
\centering
\includegraphics[trim=0 0 0 0, clip]{flat}
\caption{Schemat analizowanego systemu przetwarzania c.d.}
\label{fig:flat}
\end{figure}

\section{Model w~œrodowisku Parastation}
Opisany wy¿ej system przetwarzania zosta³ zamodelowany w~œrodowisku Parastation w~sposób przedstawiony na rysunku \ref{fig:parastation}. Niewykorzystywane procesory nie otrzyma³y numeracji, a~niewykorzystywane ³¹cza nie zosta³y uwzglêdnione na rysunku.

\begin{figure}[p]
\centering
\includegraphics[trim=0 0 0 0, clip]{parastation}
\caption{Model systemu w~œrodowisku Parastation}
\label{fig:parastation}
\end{figure}

\section{Analiza problemu}
Celem analizy by³o znalezienie odpowiedzi na pytanie o optymalny dla rozwa¿anego systemu przetwarzania plan przesy³ania danych i wykonywania obliczeñ. Plan ten powinien uwzglêdniaæ podzia³ transmisji na odpowiedni¹ iloœæ faz oraz iloœci danych przesy³anych w~ich trakcie, d¹¿¹c do jak najwczeœniejszego (a~wiêc jednoczesnego) zakoñczenia obliczeñ na wszystkich procesorach.

Odpowiedzi na postawione wy¿ej pytanie udzieli³o rozwi¹zanie odpowiedniego problemu programowania liniowego, który zosta³ sformu³owany w~sposób opisany w~kolejnych podpunktach.

\subsection{Idea rozwi¹zania}
Ze wzglêdu na mo¿liwoœæ otrzymywania danych z wielu Ÿróde³, jako podstawê w sformu³owaniu odpowiedniego problemu programowania liniowego przyjêto podejœcie nazwane przez autorów niniejszego sprawozdania "systemem kana³ów". W równaniach opisanych w kolejnych podpunktach pos³u¿ono siê 16 kana³ami przesy³ania danych ($i = 0 \ldots 15$), odpowiadaj¹cymi ró¿nym œcie¿kom, którymi dane mog¹ docieraæ do procesorów ($j = 0 \ldots 7$). Dla procesorów warstwy 1 (procesory 1, 2, 3) jest tylko 1 taka œcie¿ka, dla warstwy 2 (procesory 4, 5, 6) - 2 œcie¿ki, a dla warstwy 3 (procesor 7) - 6 œcie¿ek. W celu usprawnienia procesu obliczeñ, dane przesy³ane s¹ ka¿dym kana³em w $m$ pakietach, odpowiadaj¹cym $m$ fazom obliczeñ ($k = m-1 \ldots 0$). Po skompletowaniu pakietów ze wszystkich docieraj¹cych do procesora kana³ów dla danej fazy nastêpuje równoleg³ê przeliczenie czêœci otrzymanych danych oraz przes³anie reszty do kolejnych procesorów, jeœli takie istniej¹. Proces powtarza siê $m$ razy, do chwili zakoñczenia przetwarzania wszystkich danych.

Podsumowuj¹c powy¿szy opis, mo¿na wyró¿niæ nastêpuj¹ce kluczowe pojêcia, które bêd¹ wykorzystywane w dalszym ci¹gu sprawozdania:
\begin{description}
\item[kana³ $i$] -- œcie¿ka, któr¹ dane docieraj¹ do procesora $j$ docelowego dla tego kana³u; kana³em wysy³ane s¹ pakiety $(i,k: k = m-1 \ldots 0)$
\item[pakiet $(i,k)$] -- pojedyñcza transmisja danych pomiêdzy procesorami, s¹ to dane przesy³ane do procesora docelowego dla kana³u $i$ w fazie $k$; pakiet zawiera paczkê $(i,k)$ oraz paczki $(p: p \in after(i), k)$
\item[paczka $(i,k)$] -- fragment pakietu zawieraj¹cy dane do przetworzenia  lokalnego w fazie $k$ na procesorze docelowym kana³u $i$ 
\end{description}

Przedstawione wy¿ej pojêcia obrazuje fragment diagramu Gantta przedstawiony na rysunku \ref{fig:example}.

\begin{figure}[h]
\centering
\includegraphics[width=\textwidth, trim=0 0 0 0, clip]{example}
\caption{Fragment diagramu Gantta obrazuj¹cy wykorzystywane w sprawozdaniu pojêcia}
\label{fig:example}
\end{figure}

\newpage

\subsection{Funkcje opisuj¹ce system kana³ów}
\begin{description}
\item[$channels(j)$] -- zbiór numerów kana³ów koñcz¹cych siê w procesorze $j$
\item[$before(i)$] -- zbiór numerów kana³ów, od których zale¿y kana³ $i$, tzn. takich, którymi przesy³anie w danej fazie musi siê zakoñczyæ przed wys³aniem pakietu kana³em $i$
\item[$after(i)$] -- zbiór numerów kana³ów, które zale¿¹ od kana³u $i$, tzn. takich, którymi nie mo¿na wys³aæ w danej fazie pakietów, dopóki nie zostanie zakoñczona transmisja kana³em $i$
\end{description}

Wartoœci wymienionych wy¿ej funkcji wynikaj¹ bezpoœrednio ze struktury rozwa¿anego systemu przetwarzania. Przedstawiaj¹ je tabele ???.

\subsection{Parametry systemu Parastation}
\begin{description}
\item[$A(j)$] -- czas przetwarzania jednostki danych przez procesor $j$
\item[$C(i)$] -- czas przesy³ania jednostki danych w pakietach kana³u $i$
\item[$S$] -- czas rozruchu ³¹cza
\item[$V$] -- ca³kowity rozmiar danych do przetworzenia
\item[$m$] -- liczba faz komunikacji
\end{description}

\subsection{Zmienne decyzyjne}
\begin{description}
\item[$a(i,k)$] -- iloœæ danych w paczce $(i,k)$
\item[$r(i,k)$] -- moment gotowoœci do wys³ania pakietu $(i,k)$
\item[$x(i,k)$] -- zmienna binarna okreœlaj¹ca pakiet $(i,k)$ jest wysy³any
\item[$t(j,k)$] -- moment gotowoœci do rozpoczêcia obliczeñ przez procesor $j$ w fazie $k$
\end{description}

\subsection{Funkcje pomocnicze}

\begin{itemize}
\item rozmiar pakietu $(i,k)$
$$ S_a(i,k) = a(i,k) + \sum_{p \in next(i)} S_a(p,k)$$
\item czas przesy³ania pakietu $(i,k)$
\begin{displaymath}
T_c(i,k) = \left\{ \begin{array}{ll}
0 & \textrm{dla $i=0$}\\
x(i,k) \; S + C(i) \; S_a(i,k)   & \textrm{dla $i>0$}
\end{array} \right.
\end{displaymath}
\item czas wykonywania obliczeñ przez procesor $j$ w fazie $k$
$$T_a(j,k) = A(j) \, \sum_{p \in channels(j)} a(p,k)$$
\end{itemize}

\subsection{Funkcja celu}
\begin{quotation}
$$\textrm{min:} \; t$$
\end{quotation}

\subsection{Ograniczenia}
\begin{itemize}
\item pakiety $(i:i = 1 \ldots 3,m-1)$ s¹ dostêpne w~chwili $t = 0$
$$r(i, m-1) = 0 \qquad i = 1 \ldots 3$$
\item pakiet $(i,k)$ mo¿na wys³aæ dopiero po odebraniu wszystkich danych wchodz¹cych w jego sk³ad
$$ \forall p \in prev(i) \quad x(p,k)\, r(p,k) + T_c(p,k) \leq r(i,k) \qquad i = 0 \ldots 15, \; k = 0 \ldots m-1$$
\item obliczenia na procesorze $j$ mo¿na rozpocz¹c w fazie $k$ dopiero po otrzymaniu pakietów ze wszystkich dochodz¹cych do niego kana³ów
$$ \forall p \in packets(j) \quad x(p,k) r(p, k) + T_c(p, k) \leq t(j, k) \qquad j = 0 \ldots 7, \; k = 0 \ldots m-1$$
\item kolejne fazy przesy³ania pakietów musz¹ przebiegaæ sekwencyjnie
$$r(i,k) + T_c(i,k) \leq r(i, k - 1) \qquad i = 0 \ldots 15, \; k = 1 \ldots m-1$$
\item kolejne fazy przetwarzania paczek musz¹ przebiegaæ sekwencyjnie
$$t(j,k) + T_a(j,k) \leq t(j, k-1) \qquad j = 0 \ldots 7, \; k = 1 \ldots m-1$$
\item obliczanie ostatniej paczki musi zakoñczyæ siê przed koñcem przetwarzania
$$t(j,0) + T_a(j,0) \leq T \qquad j = 0 \ldots 7$$
\item suma wielkoœci wszystkich paczek musi byæ równa rozmiarowi danych wejœciowych
$$ \sum_{i = 0}^{15} \sum_{k = 0}^{m-1} a(i,k) = V$$
\item zapewnia, ¿e je¿eli pakiet $(i,k)$ ma niezerow¹ d³ugoœæ, to odpowiadaj¹ca mu zmienna binarna ma wartoœæ 1
$$ S_a(i, k) \leq V \, x(i, k) \qquad i = 0 \ldots 15, \; k = 0 \ldots m-1$$
\end{itemize}

\section{Rozwi¹zanie przyk³adowego problemu}

Przedstawiony w~poprzednich punktach problem programowania liniowego rozwi¹zano przyjmuj¹c iloœci faz komunikacji od 1 do 10 oraz charakterystykê systemu Parastation opisan¹ poni¿ej.

$$S = 11$$
$$A(0) = A(2) = A(3) = A(5) = 20$$
$$A(1) = A(4) = A(6) = A(7) = 16$$
$$C(1) = C(6) = C(13) = C(14) = C(9) = 2.2$$
$$C(2) = C(3) = C(4) = C(5) = C(7) = C(8) = C(10) = C(11) = C(12) = C(15) = 4.4$$
$$V = 10000$$

Na podstawie danych uzyskanych w~wyniku obliczeñ wykreœlono zale¿noœæ czasu przetwarzania od iloœci faz komunikacji. Przedstawia j¹ wykres na rysunku \ref{fig:wykres}.

\begin{figure}[h!]
\centering
\includegraphics[width=\textwidth, trim=0 0 0 0, clip]{wykres}
\caption{Wykres czasu przetwarzania}
\label{fig:wykres}
\end{figure}

Minimalny czas przetwarzania w~systemie Parastation, przy za³o¿eniu, ¿e w~chwili $t=0$ dane znajduj¹ siê ju¿ we wszystkich procesorach, wynosi:

$$T_{min} = V \; \frac{1}{\frac{4}{A_1} + \frac{4}{A_2}}$$

gdzie $A_1$ i~$A_2$ to szybkoœci procesorów.

Dla przyjêtych danych czas ten wynosi $T_{min} \approx 22222$. Przedstawiony wykres pokazuje, ¿e wraz ze wzrostem iloœci faz komunikacji czas przetwarzania zbli¿a siê asymptotycznie do tej granicy.

Diagramy Gantta odpowiadaj¹ce rozwi¹zaniom dla iloœci faz 1, 3 i~5 przedstawiaj¹ wykresy na rysunkach od \ref{fig:wykres1} do \ref{fig:wykres5}. Poszczególne paczki zosta³y pogrupowane wed³ug numerów procesorów, dla których s¹ przeznaczone, a obok wykresów przedstawiaj¹cych ich transmisjê umieszczono informacjê o œcie¿ce, któr¹ pod¹¿a³y dane w nich zawarte. Liczby na samym wykresie informuj¹ o numerze fazy, w której dana czêœæ zosta³a przes³ana.

\begin{figure}[h!]
\centering
\includegraphics[width=\textwidth, trim=0 0 0 0, clip]{wykres1}
\caption{Wykres Gantta dla liczby paczek $m=1$}
\label{fig:wykres1}
\end{figure}

\begin{figure}[h!]
\centering
\includegraphics[width=\textwidth, trim=0 0 0 0, clip]{wykres3}
\caption{Wykres Gantta dla liczby paczek $m=3$}
\label{fig:wykres3}
\end{figure}

\begin{figure}[h!]
\centering
\includegraphics[width=\textwidth, trim=0 0 0 0, clip]{wykres5}
\caption{Wykres Gantta dla liczby paczek $m=5$}
\label{fig:wykres5}
\end{figure}

\end{document}
