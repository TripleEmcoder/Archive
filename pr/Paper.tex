\documentclass[12pt,a4paper,titlepage,twoside]{article}
\usepackage[T1]{fontenc}
\usepackage[cp1250]{inputenc}
\usepackage[english,polish]{babel}
\usepackage[T1]{polski}
\usepackage{times}
\usepackage{fancyhdr}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{slashbox}
\usepackage{sistyle}
\usepackage{amsfonts}
\usepackage{latexsym}
%\usepackage{notebook2e, latexsym}

\hypersetup
{
	bookmarksnumbered=true,
	colorlinks=true,
	linkcolor=blue,
	bookmarksopen=true,
	bookmarksopenlevel=2,
	pdfstartview={FitH}
}

\SIdecimalsign{,}

\setlength{\textheight}{24cm}
\setlength{\textwidth}{16cm}
\setlength{\footskip}{10mm}
\setlength{\oddsidemargin}{0mm}
\setlength{\evensidemargin}{0mm}
\setlength{\topmargin}{0mm}
\setlength{\headsep}{5mm}
\setlength{\headheight}{15.0pt}

\pagestyle{fancy}
\fancyhead{}
\fancyhead[LE,RO]{\textsf{\thepage}}
\fancyhead[RE,LO]{\textsf{Szeregowanie zadañ jednorodnych}}
\fancyhead[CE,CO]{\ }
\fancyfoot[LE,RO]{\ }
\fancyfoot[RE,LO]{\ }
\fancyfoot[CE,CO]{\ }
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}

\begin{titlepage}
\title{Przetwarzanie równoleg³e \\ Szeregowanie zadañ jednorodnych}
\author{Bartosz Kukawka (75911) \\ Marcin Miko³ajczak (75922) \\ Grupa I3A}
\end{titlepage}

\begin{document}

\maketitle

\newpage

\section{Sformu³owanie problemu}
Przedmiotem niniejszego sprawozdania jest analiza problemu przetwarzania równoleg³ego w oœmioprocesorowym systemie przetwarzania o topologii szeœcianu, który cechuje mo¿liwoœæ jednoczesnego wykonywania obliczeñ i~przesy³ania danych przez ka¿dy z~jego procesorów. Dodatkowo zak³ada siê, ¿e w~chwili zerowej obliczeñ wszystkie dane potrzebne do ich wykonania znajduj¹ siê w~jednym z~naro¿ników wspomnianego szeœcianu.

Analizowany system wraz z~przyjêtymi oznaczeniami procesorów przedstawiaj¹ pogl¹dowo rysunki \ref{fig:cube} i~\ref{fig:flat}. Procesor, który pocz¹tkowo dysponuje wszystkimi danymi, zosta³ oznaczony numerem 0. Dalsza numeracja wynika z~odleg³oœci od Ÿród³a danych. Poœród procesorów o równej odleg³oœci numeracja zosta³a przydzielona na podstawie rzutu z~rysunku \ref{fig:cube} w~kolejnoœci zgodnej z~ruchem wskazówek zegara, poczynaj¹c od procesorów na górnej, tylnej krawêdzi szeœcianu. Inny widok omawianego systemu przedstawia rysunek \ref{fig:flat}.

\begin{figure}[h!]
\centering
\includegraphics[trim=0 15mm 0 15mm, clip]{cube}
\caption{Schemat analizowanego systemu przetwarzania}
\label{fig:cube}
\end{figure}

\begin{figure}[h!]
\centering
\includegraphics[trim=0 0 0 0, clip]{flat}
\caption{Schemat analizowanego systemu przetwarzania c.d.}
\label{fig:flat}
\end{figure}

\section{Model w~œrodowisku Parastation}
Opisany wy¿ej system przetwarzania zosta³ zamodelowany w~œrodowisku Parastation w~sposób przedstawiony na rysunku \ref{fig:parastation}. Niewykorzystywane procesory nie otrzyma³y numeracji, a~niewykorzystywane ³¹cza nie zosta³y uwzglêdnione na rysunku.

\begin{figure}[h!]
\centering
\includegraphics[trim=0 0 0 0, clip]{parastation}
\caption{Model systemu w~œrodowisku Parastation}
\label{fig:parastation}
\end{figure}

\section{Analiza problemu}
Celem analizy by³o znalezienie odpowiedzi na pytanie o optymalny dla rozwa¿anego systemu przetwarzania plan przesy³ania danych i wykonywania obliczeñ. Plan ten powinien uwzglêdniaæ podzia³ transmisji na odpowiedni¹ iloœæ faz oraz iloœci danych przesy³anych w~ich trakcie, d¹¿¹c do jak najwczeœniejszego (a~wiêc jednoczesnego) zakoñczenia obliczeñ na wszystkich procesorach.

Odpowiedzi na postawione wy¿ej pytanie udzieli³o rozwi¹zanie odpowiedniego problemu programowania liniowego, który zosta³ sformu³owany w~sposób opisany w~kolejnych podpunktach.

\subsection{Idea rozwi¹zania}
Ze wzglêdu na mo¿liwoœæ otrzymywania danych z wielu Ÿróde³, jako podstawê w sformu³owaniu odpowiedniego problemu programowania liniowego przyjêto podejœcie nazwane przez autorów niniejszego sprawozdania "systemem paczek". W równaniach opisanych w kolejnych podpunktach pos³u¿ono siê 16 paczkami danych ($i = 0 \ldots 15$), odpowiadaj¹cymi ró¿nym œcie¿kom, którymi dane mog¹ docieraæ do procesorów ($j = 0 \ldots 7$). Dla procesorów warstwy 1 (procesory 1, 2, 3) jest tylko 1 taka œcie¿ka, dla warstwy 2 (procesory 4, 5, 6) - 2 œcie¿ki, a dla warstwy 3 (procesor 7) - 6 œcie¿ek. Ograniczenia zosta³y skonstruowane tak, aby paczki dla ka¿dej z warstw zawiera³y w sobie równie¿ dane dla warst kolejnych, jeœli takie istniej¹.
W celu usprawnienia procesu obliczeñ, ka¿da paczka przesy³ana jest w $m$ czêœciach/fazach ($k = m-1 \ldots 0$). Po skompletowaniu wszystkich czêœci paczek dla danej fazy nastêpuje przeliczenie otrzymanych danych. Proces powtarza siê $m$ razy, do chwili zakoñczenia przetwarzania wszystkich danych.

\subsection{Parametry systemu Parastation}
\begin{description}
\item[$A(j)$] -- czas przetwarzania jednostki danych przez procesor $j$
\item[$C(i)$] -- czas przesy³ania jednostki danych w paczce $i$ (czas ten wynika z prêdkoœci ³¹cza, którym przesy³ana jest dana paczka)
\item[$S$] -- czas rozruchu ³¹cza
\item[$V$] -- ca³kowity rozmiar danych do przetworzenia
\item[$m$] -- liczba faz komunikacji (czêœci, na które dzielone s¹ paczki)
\end{description}

\subsection{Funkcje opisuj¹ce system paczek}
\begin{description}
\item[$packets(j)$] -- zbiór numerów paczek przeznaczonych dla procesora $j$
\item[$prev(i)$] -- zbiór numerów paczek, których przesy³anie musi siê zakoñczyæ przed wys³aniem paczki $i$ (okreœla numer paczki $p$, której czêœci¹ jest paczka $i$ oraz -- w przypadku ³¹czy, którymi przesy³ane s¹ 2 paczki -- numer paczki przesy³anej wczeœniej, co eliminuje ryzyko zaplanowania 2 jednoczesnych transmisji tym samym ³¹czem).
\item[$next(i)$] -- zbiór numerów paczek, które zawarte s¹ w paczce $i$
\end{description}

Wartoœci wymienionych wy¿ej funkcji wynikaj¹ bezpoœrednio ze struktury rozwa¿anego systemu przetwarzania.

\subsection{Zmienne decyzyjne}
\begin{description}
\item[$a(i,k)$] -- iloœæ danych z czêœci paczki $i$ przes³anej w fazie $k$ liczona na jej procesorze docelowym (por. $S_a$)
\item[$r(i,k)$] -- moment gotowoœci do wys³ania czêœci paczki $i$ w fazie $k$
\item[$x(i,k)$] -- zmienna binarna okreœlaj¹ca czy czêœæ paczki $i$ jest wysy³ana w fazie $k$
\item[$t(j,k)$] -- moment gotowoœci do rozpoczêcia obliczeñ przez procesor $j$ w fazie $k$ (moment skompletowania danych dla tej fazy)
\end{description}

\subsection{Funkcje pomocnicze}

\begin{itemize}
\item rozmiar czêœci paczki $i$ przesy³anej w fazie $k$, czyli suma iloœci danych liczonych w tej fazie na procesorze docelowym dla tej paczki i procesorach, które otrzymuj¹ dane z niej pochodz¹ce
$$ S_a(i,k) = a(i,k) + \sum_{p \in next(i)} S_a(p,k)$$
\item czas przesy³ania czêœci paczki $i$ w fazie $k$
\begin{displaymath}
T_c(i,k) = \left\{ \begin{array}{ll}
0 & \textrm{dla $i=0$}\\
x(i,k) \; S + C(i) \; S_a(i,k)   & \textrm{dla $i>0$}
\end{array} \right.
\end{displaymath}
\item czas wykonywania obliczeñ przez procesor $j$ w fazie $k$
$$T_a(j,k) = A(j) \, \sum_{p \in packets(j)} a(p,k)$$
\end{itemize}

\subsection{Funkcja celu}
\begin{quotation}
$$\textrm{min:} \; t$$
\end{quotation}

\subsection{Ograniczenia}
\begin{itemize}
\item czêœci paczek przesy³ane w fazie $m-1$ do procesorów $1 \ldots 3$ s¹ dostêpne w~chwili $t = 0$
$$r(i, m-1) = 0 \qquad i = 1 \ldots 3$$
\item czêœæ paczki $i$ przesy³ana w fazie $k$ nie mo¿e byæ wys³ana przed zakoñczeniem odbierania czêœci paczek o numerach okreœlonych przez funkcjê $prev(i)$ przesy³anych w tej fazie
$$ \forall p \in prev(i) \quad x(p,k)\, r(p,k) + T_c(p,k) \leq r(i,k) \qquad i = 0 \ldots 15, \; k = 0 \ldots m-1$$
\item procesor musi skompletowaæ czêœci z fazy $k$ wszystkich paczek dla niego przeznaczonych przed rozpoczêciem obliczeñ w tej fazie (dziêki zmiennej binarnej uwzglêdniane s¹ tylko czêœci o niezerowej d³ugoœci)
$$ \forall p \in packets(j) \quad x(p,k) r(p, k) + T_c(p, k) \leq t(j, k) \qquad j = 0 \ldots 7, \; k = 0 \ldots m-1$$
\item kolejne fazy przesy³ania paczek musz¹ przebiegaæ sekwencyjnie
$$r(i,k) + T_w(i,k) \leq r(i, k - 1) \qquad i = 0 \ldots 15, \; k = 1 \ldots m-1$$
\item kolejne fazy przetwarzania paczek musz¹ przebiegaæ sekwencyjnie
$$t(j,k) + T_a(j,k) \leq t(j, k-1) \qquad j = 0 \ldots 7, \; k = 1 \ldots m-1$$
\item obliczanie ostatniej paczki musi zakoñczyæ siê przed koñcem przetwarzania
$$t(j,0) + T_a(j,0) \leq T \qquad j = 0 \ldots 7$$
\item suma wielkoœci wszystkich paczek musi byæ równa rozmiarowi danych wejœciowych
$$ \sum_{i = 0}^{15} \sum_{k = 0}^{m-1} a(i,k) = V$$
\item zapewnia, ¿e je¿eli paczka ma niezerow¹ d³ugoœæ, to odpowiadaj¹ca jej zmienna binarna ma wartoœæ 1
$$ S_a(i, k) \leq V \, x(i, k) \qquad i = 0 \ldots 15, \; k = 0 \ldots m-1$$
\end{itemize}

\section{Rozwi¹zanie przyk³adowego problemu}

Przedstawiony w~poprzednich punktach problem programowania liniowego rozwi¹zano przyjmuj¹c iloœci faz komunikacji od 1 do 10 oraz charakterystykê systemu Parastation opisan¹ poni¿ej.

$$S = 11$$
$$A(0) = A(2) = A(3) = A(5) = 20$$
$$A(1) = A(4) = A(6) = A(7) = 16$$
$$C(1) = C(6) = C(13) = C(14) = C(9) = 2.2$$
$$C(2) = C(3) = C(4) = C(5) = C(7) = C(8) = C(10) = C(11) = C(12) = C(15) = 4.4$$
$$V = 10000$$

Na podstawie danych uzyskanych w~wyniku obliczeñ wykreœlono zale¿noœæ czasu przetwarzania od iloœci faz komunikacji. Przedstawia j¹ wykres na rysunku \ref{fig:wykres}.

\begin{figure}[h!]
\centering
\includegraphics[width=\textwidth, trim=0 0 0 0, clip]{wykres}
\caption{Wykres czasu przetwarzania}
\label{fig:wykres}
\end{figure}

Minimalny czas przetwarzania w~systemie Parastation, przy za³o¿eniu, ¿e w~chwili $t=0$ dane znajduj¹ siê ju¿ we wszystkich procesorach, wynosi:

$$T_{min} = V \; \frac{1}{\frac{4}{A_1} + \frac{4}{A_2}}$$

gdzie $A_1$ i~$A_2$ to szybkoœci procesorów.

Dla przyjêtych danych czas ten wynosi $T_{min} \approx 22222$. Przedstawiony wykres pokazuje, ¿e wraz ze wzrostem iloœci faz komunikacji czas przetwarzania zbli¿a siê asymptotycznie do tej granicy.

Diagramy Gantta odpowiadaj¹ce rozwi¹zaniom dla iloœci faz 1, 3 i~5 przedstawiaj¹ wykresy na rysunkach od \ref{fig:wykres1} do \ref{fig:wykres5}. Poszczególne paczki zosta³y pogrupowane wed³ug numerów procesorów, dla których s¹ przeznaczone, a obok wykresów przedstawiaj¹cych ich transmisjê umieszczono informacjê o œcie¿ce, któr¹ pod¹¿a³y dane w nich zawarte. Liczby na samym wykresie informuj¹ o numerze fazy, w której dana czêœæ zosta³a przes³ana.

\begin{figure}[h!]
\centering
\includegraphics[width=\textwidth, trim=0 0 0 0, clip]{wykres1}
\caption{Wykres Gantta dla liczby paczek $m=1$}
\label{fig:wykres1}
\end{figure}

\begin{figure}[h!]
\centering
\includegraphics[width=\textwidth, trim=0 0 0 0, clip]{wykres3}
\caption{Wykres Gantta dla liczby paczek $m=3$}
\label{fig:wykres3}
\end{figure}

\begin{figure}[h!]
\centering
\includegraphics[width=\textwidth, trim=0 0 0 0, clip]{wykres5}
\caption{Wykres Gantta dla liczby paczek $m=5$}
\label{fig:wykres5}
\end{figure}

\end{document}
