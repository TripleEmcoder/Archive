\documentclass[12pt,a4paper,titlepage,twoside]{article}
\usepackage[T1]{fontenc}
\usepackage[cp1250]{inputenc}
\usepackage[english,polish]{babel}
\usepackage[T1]{polski}
\usepackage{times}
\usepackage{fancyhdr}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{slashbox}
\usepackage{sistyle}
\usepackage{amsfonts}
\usepackage{latexsym}
%\usepackage{notebook2e, latexsym}

\hypersetup
{
	bookmarksnumbered=true,
	colorlinks=true,
	linkcolor=blue,
	bookmarksopen=true,
	bookmarksopenlevel=2,
	pdfstartview={FitH}
}

\SIdecimalsign{,}

\setlength{\textheight}{24cm}
\setlength{\textwidth}{16cm}
\setlength{\footskip}{10mm}
\setlength{\oddsidemargin}{0mm}
\setlength{\evensidemargin}{0mm}
\setlength{\topmargin}{0mm}
\setlength{\headsep}{5mm}
\setlength{\headheight}{15.0pt}

\pagestyle{fancy}
\fancyhead{}
\fancyhead[LE,RO]{\textsf{\thepage}}
\fancyhead[RE,LO]{\textsf{Szeregowanie zadañ jednorodnych}}
\fancyhead[CE,CO]{\ }
\fancyfoot[LE,RO]{\ }
\fancyfoot[RE,LO]{\ }
\fancyfoot[CE,CO]{\ }
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}

\begin{titlepage}
\title{Przetwarzanie równoleg³e \\ Szeregowanie zadañ jednorodnych}
\author{Bartosz Kukawka (75911) \\ Marcin Miko³ajczak (75922) \\ Grupa I3A}
\end{titlepage}

\begin{document}

\maketitle

\newpage

\section{Sformu³owanie problemu}
Przedmiotem niniejszego sprawozdania jest analiza problemu przetwarzania równoleg³ego w oœmioprocesorowym systemie przetwarzania o topologii szeœcianu, który cechuje mo¿liwoœæ jednoczesnego wykonywania obliczeñ i~przesy³ania danych przez ka¿dy z~jego procesorów. Dodatkowo zak³ada siê, ¿e w~chwili zerowej obliczeñ wszystkie dane potrzebne do ich wykonania znajduj¹ siê w~jednym naro¿niku wspomnianego szeœcianu.

Analizowany system wraz z~przyjêtymi oznaczeniami procesorów przedstawiaj¹ pogl¹dowo rysunki \ref{fig:cube} i~\ref{fig:flat}. Procesor, który pocz¹tkowo dysponuje wszystkimi danymi, zosta³ oznaczony przez 0. Dalsza numeracja wynika z~odleg³oœci od Ÿród³a danych. Poœród procesorów o równej odleg³oœci numeracja zosta³a przydzielona na podstawie rzutu z~rysunku \ref{fig:cube} w~kolejnoœci zgodnej z~ruchem wskazówek zegara, poczynaj¹c od procesorów na górnej, tylnej krawêdzi szeœcianu.

\begin{figure}[h!]
\centering
\includegraphics[trim=0 15mm 0 15mm, clip]{cube}
\caption{Schemat analizowanego systemu przetwarzania}
\label{fig:cube}
\end{figure}

\begin{figure}[h!]
\centering
\includegraphics[trim=0 0 0 0, clip]{flat}
\caption{Schemat analizowanego systemu przetwarzania c.d.}
\label{fig:flat}
\end{figure}

\section{Model w~œrodowisku Parastation}
Opisany wy¿ej system przetwarzania zosta³ zamodelowany w~œrodowisku Parastation w~sposób przedstawiony na rysunku \ref{fig:parastation}. Niewykorzystywane procesory nie otrzyma³y numeracji, a~niewykorzystywane ³¹cza nie zosta³y uwzglêdnione na rysunku.

\begin{figure}[h!]
\centering
\includegraphics[trim=0 0 0 0, clip]{parastation}
\caption{Model systemu w~œrodowisku Parastation}
\label{fig:parastation}
\end{figure}

\section{Analiza problemu}
Celem analizy by³o znalezienie odpowiedzi na pytanie o optymalny dla rozwa¿anego systemu przetwarzania plan przesy³ania danych i wykonywania obliczeñ. Plan ten powinien uwzglêdniaæ podzia³ transmisji na odpowiedni¹ iloœæ faz oraz wielkoœci paczek przesy³anych w~ich trakcie, d¹¿¹c do jak najwczeœniejszego (a~wiêc jednoczesnego) zakoñczenia obliczeñ na wszystkich procesorach.

Odpowiedzi na postawione wy¿ej pytania udzieli³o rozwi¹zanie odpowiedniego problemu programowania liniowego, który zosta³ sformu³owany w~sposób opisany w~kolejnych podpunktach.

\subsection{Idea rozwi¹zania}
Ze wzglêdu na mo¿liwoœæ otrzymywania danych z wielu Ÿróde³, jako podstawê w sformu³owaniu odpowiedniego problemu programowania liniowego przyjêto 16 paczek ($i = 0 \ldots 15$) danych, odpowiadaj¹cych ró¿nym œcie¿kom, którymi mog¹ one docieraæ do procesorów ($j = 0 \ldots 7$). Dla procesorów warstwy 1 (procesory 1, 2, 3) jest tylko 1 taka œcie¿ka, dla warstwy 2 (procesory 4, 5, 6) - 2 œcie¿ki, a dla warstwy 3 (procesor 7) - 6 œcie¿ek.
Dodatkowo ka¿da paczka jest przesy³ana w kilku fazach ($k = m-1 \ldots 0$).

\subsection{Dane wejœciowe}
\begin{description}
\item[$A(j)$] -- czas przetwarzania jednostki danych przez procesor $j$
\item[$C(i)$] -- czas przesy³ania jednostki danych w paczce $i$
\item[$S$] -- czas rozruchu ³¹cza
\item[$V$] -- ca³kowity rozmiar danych
\item[$m$] -- liczba faz komunikacji
\end{description}

\subsection{Zmienne decyzyjne}
\begin{description}
\item[$a(i,k)$] -- wielkoœæ paczki $i$ w fazie $k$
\item[$r(i,k)$] -- moment gotowoœci do wys³ania paczki $i$ w fazie $k$
\item[$x(i,k)$] -- zmienna binarna okreœlaj¹ca czy paczka $i$ jest wysy³ana w fazie $k$
\item[$t(j,k)$] -- moment gotowoœci do obliczeñ procesora $j$ w fazie $k$
\end{description}

\subsection{Funkcje pomocnicze}
\begin{description}
\item[$proc(i)$] -- numer procesora docelowego dla paczki $i$
\item[$prev(i)$] -- zbiór paczek, których przesy³anie musi siê zakoñczyæ przed wys³aniem paczki $i$
\item[$next(i)$] -- zbiór paczek
\end{description}
Funkcja $prev(i)$ okreœla numer paczki $p$, której czêœci¹ jest paczka $i$ oraz -- w przypadku ³¹czy, którymi przesy³ane s¹ 2 paczki -- numer paczki przesy³anej wczeœniej.

Wartoœci obu funkcji wynikaj¹ bezpoœrednio ze struktury rozwa¿anego systemu przetwarzania.

%!! popraw
\begin{itemize}
\item SA
$$ S_a(i,k) = a(i,k) + \sum_{p \in next(i)} S_a(p,k)$$
\item TC
\begin{displaymath}
T_c(i,k) = \left\{ \begin{array}{ll}
0 & \textrm{dla $i=0$}\\
x(i,k) \; S + C(i) \; S_a   & \textrm{dla $i>0$}
\end{array} \right.
\end{displaymath}
\item TA
$$T_a(j,k) = A(j) \, a(j,k)$$
\end{itemize}

\subsection{Funkcja celu}
\begin{quotation}
$$\textrm{min:} \; t$$
\end{quotation}

\subsection{Ograniczenia}
\begin{itemize}
\item paczki dla procesorów 1..3 w fazie m-1 s¹ dostêpne w~chwili $t = 0$
$$r(i, m-1) = 0 \qquad i = 1 \ldots 3$$
\item paczka nie mo¿e byæ przes³ana do kolejnego procesora przed zakoñczeniem przesy³ania paczek o numerach okreœlonych przez funkcjê $prev(i)$
$$ \forall p \in prev(i) \quad x(p,k)\, r(p,k) + T_c(p,k) \leq r(i,k) \qquad i = 0 \ldots 15, \; k = 0 \ldots m-1$$
\item nie mo¿na rozpocz¹æ obliczenia paczki przed zakoñczeniem jej odbierania
$$ x(i, k) r(i, k) + T_w(i, k) \leq t(proc(i), k) \qquad i = 0 \ldots 15, \; k = 0 \ldots m-1$$
\item kolejne fazy przesy³ania paczek musz¹ przebiegaæ sekwencyjnie
$$r(i, k) + T_w(i,k) \leq r(i, k - 1) \qquad i = 0 \ldots 15, \; k = 1 \ldots m-1$$
\item kolejne fazy przetwarzania paczek musz¹ przebiegaæ sekwencyjnie
$$t(j, k) + T_a(j,k) \leq t(j, k-1) \qquad j = 0 \ldots 7, \; k = 1 \ldots m-1$$
\item obliczanie ostatniej paczki musi zakoñczyæ siê przed koñcem przetwarzania
$$t(j, 0) + T_a(j,0) \leq T \qquad j = 0 \ldots 7$$
\item suma wielkoœci wszystkich paczek musi byæ równa rozmiarowi danych wejœciowych
$$ \sum_{i = 0}^{15} \sum_{k = 0}^{m-1} a(i,k) = v$$
\item
$$ S_a(i, k) \leq V \, x(i, k) \qquad i = 0 \ldots 15, \; k = 0 \ldots m-1$$
\end{itemize}

\section{Rozwi¹zanie przyk³adowego problemu}

Przedstawiony w~poprzednich punktach problem programowania liniowego rozwi¹zano przyjmuj¹c iloœci faz komunikacji od 1 do 10 oraz charakterystykê systemu Parastation opisan¹ poni¿ej.

%!!!!
$$S = 11$$
$$A(0) = A(2) = A(3) = A(5) = 16$$
$$A(1) = A(4) = A(6) = A(7) = 20$$
$$C(1) = C(6) = 2.2$$
$$C(2) = C(3) = C(4) = C(5) = C(7) = 4.4$$
$$V = 10000$$

Na podstawie danych uzyskanych w~wyniku obliczeñ wykreœlono zale¿noœæ czasu przetwarzania od iloœci faz komunikacji. Przedstawia j¹ wykres na rysunku \ref{fig:wykres}.

\begin{figure}[h!]
\centering
\includegraphics[width=\textwidth, trim=0 0 0 0, clip]{wykres}
\caption{Wykres czasu przetwarzania}
\label{fig:wykres}
\end{figure}

Minimalny czas przetwarzania w~systemie Parastation, przy za³o¿eniu, ¿e w~chwili $t=0$ dane znajduj¹ siê ju¿ we wszystkich procesorach, wynosi:

$$T_{min} = V \; \frac{1}{\frac{4}{A_1} + \frac{4}{A_2}}$$

gdzie $A_1$ i~$A_2$ to szybkoœci procesorów.

Dla przyjêtych danych czas ten wynosi $T_{min} \approx 22222$. Przedstawiony wykres pokazuje, ¿e wraz ze wzrostem iloœci faz komunikacji czas przetwarzania zbli¿a siê asymptotycznie do tej granicy.

Diagramy Gantta odpowiadaj¹ce rozwi¹zaniom dla iloœci faz 1, 3 i~5 przedstawiaj¹ wykresy na rysunkach od \ref{fig:wykres1} do \ref{fig:wykres5}

\begin{figure}[h!]
\centering
\includegraphics[width=\textwidth, trim=0 0 0 0, clip]{wykres1}
\caption{Wykres Gantta dla liczby paczek $m=1$}
\label{fig:wykres1}
\end{figure}

\begin{figure}[h!]
\centering
\includegraphics[width=\textwidth, trim=0 0 0 0, clip]{wykres3}
\caption{Wykres Gantta dla liczby paczek $m=3$}
\label{fig:wykres3}
\end{figure}

\begin{figure}[h!]
\centering
\includegraphics[width=\textwidth, trim=0 0 0 0, clip]{wykres5}
\caption{Wykres Gantta dla liczby paczek $m=5$}
\label{fig:wykres5}
\end{figure}

\end{document}
